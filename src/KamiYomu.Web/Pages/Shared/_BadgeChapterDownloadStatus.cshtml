@using KamiYomu.Web.Entities
@using System.Text
@using KamiYomu.Web.Infrastructure.Services.Interfaces
@inject IUserClockManager UserClockService
@model ChapterDownloadRecord

@{
    var rowId = $"row-{Model.Id}";
    var badgeClass = Model.DownloadStatus switch
    {
        Entities.Definitions.DownloadStatus.ToBeRescheduled => "bg-warning",
        Entities.Definitions.DownloadStatus.Scheduled => "bg-primary",
        Entities.Definitions.DownloadStatus.InProgress => "bg-info",
        Entities.Definitions.DownloadStatus.Completed => "bg-success",
        Entities.Definitions.DownloadStatus.Cancelled => "bg-danger",
        _ => "bg-secondary"
    };
    var lastUpdateBuilder = new StringBuilder();
    lastUpdateBuilder.AppendLine($"{I18n.LastUpdate}: {UserClockService.ConvertToUserTime(Model.StatusUpdateAt.GetValueOrDefault()).ToString("g")}.");
    if (!string.IsNullOrWhiteSpace(Model.StatusReason))
    {
        lastUpdateBuilder.AppendLine(Model.StatusReason);
    }
}
<span class="badge @badgeClass" title="@lastUpdateBuilder.ToString()"
      data-bs-toggle="popover"
      data-bs-trigger="hover focus"
      data-bs-placement="top"
      data-bs-content="@lastUpdateBuilder.ToString()">
    @(I18n.ResourceManager.GetString(Model.DownloadStatus.ToString())
        ?? Model.DownloadStatus.ToString())
</span>



<script>
    document.addEventListener('DOMContentLoaded', function () {
        const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
        popoverTriggerList.forEach(function (el) {
            new bootstrap.Popover(el);
        });
    });
</script>
